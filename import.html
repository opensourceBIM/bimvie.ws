<div class="import">
	<div class="modal fade" tabindex="-1" role="dialog">
		<div class="modal-dialog" role="document">
	   	   	<div class="modal-content">	
				<div class="modal-header">
			    	<a class="close" data-dismiss="modal">&times;</a>
			    	<h3>Import demo data</h3>
			  	</div>
	    		<div class="modal-body">
	    			<p>
	    			This process will create a new Main project called "Schependomlaan". Several files will be downloaded from <a href="https://github.com/buildingSMART/Sample-Test-Files/tree/master/IFC%202x3/Schependomlaan">The Schependomlaan project page</a> to your server.
	    			</p>
	    			
	    			<p>
	    			This could take up to 60 minutes to complete. Make sure your server machine has at least 4GB assigned to BIMserver.
	    			</p>
	    			
	    			<div class="message ih">
	    			</div>
	    			<div class="progress ih">
					  <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
					    <span class="sr-only"></span>
					  </div>
					</div>
				</div>
			  	<div class="modal-footer">
			    	<a class="btn btn-default" data-dismiss="modal">Close</a>
			    	<a class="btn startBtn btn-primary">Start</a>
			  	</div>
			</div>
		</div>
	</div>
</div>
<script>
function Import(cd, main) {
	var o = this;

	o.structure = {
		"Schependomlaan": {
			"Architecture": "Design model IFC/IFC Schependomlaan.ifc",
			"Construction": "Coordination model and subcontractors models/BIMsight Projectdata1/V_L_Constructief.ifc",
			"Engineering": {
				"concrete floors": "Coordination model and subcontractors models/BIMsight Projectdata1/ROOT-breedplaatvloeren.ifczip", 
				"load bearing facade": "Coordination model and subcontractors models/BIMsight Projectdata1/ROOT-lateien_en_geveldragers.ifczip",
				"prefab stairs": "Coordination model and subcontractors models/BIMsight Projectdata1/ROOT-prefab_trappen.ifczip",
				"steel": "Coordination model and subcontractors models/BIMsight Projectdata1/ROOT-staal.ifczip",
				"hollow core": "Coordination model and subcontractors models/BIMsight Projectdata1/ROOT-kanaalplaatvloer.ifczip",
				"prefab balconies": "Coordination model and subcontractors models/BIMsight Projectdata1/ROOT-prefab_balkons.ifczip",
				"roof": "Coordination model and subcontractors models/BIMsight Projectdata1/ROOT-kapconstructie_dakkapellen_platdak.ifczip",
				"vebo": "Coordination model and subcontractors models/BIMsight Projectdata1/ROOT-Vebo.ifczip",
				"limestone": "Coordination model and subcontractors models/BIMsight Projectdata1/ROOT-kalkzandsteen.ifczip",
				"prefab floors": "Coordination model and subcontractors models/BIMsight Projectdata1/ROOT-prefab_vloer_lifttop.ifczip",
				"stair railings": "Coordination model and subcontractors models/BIMsight Projectdata1/ROOT-traphekken.ifczip",
				"wooden windows": "Coordination model and subcontractors models/BIMsight Projectdata1/ROOT-houten kozijnen.ifczip"
			},
			"MEP": "Coordination model and subcontractors models/BIMsight Projectdata1/HB_Nutsvoorzieningen.ifc",
			"Suppliers": {
				"BERNTS": "Coordination model and subcontractors models/BIMsight Projectdata1/BERNTS-Staalconstructie.ifc",
				"FEK": {
					"balcony": "Coordination model and subcontractors models/BIMsight Projectdata1/FEK - Balkonhekken en borstweringsleuningen.IFC",
					"french balcony": "Coordination model and subcontractors models/BIMsight Projectdata1/FEK - Franse balkonhekken en doorvalbeveiliging.IFC",
					"other": "Coordination model and subcontractors models/BIMsight Projectdata1/BALKONHEKKEN 23-9-2015.IFC",
					"stair railing": "Coordination model and subcontractors models/BIMsight Projectdata1/FEK - Traphekken.IFC"
				},
				"GEELEN": {
					"1st floor": "Coordination model and subcontractors models/BIMsight Projectdata1/GEELEN-Breedplaat V1.ifc",
					"2nd floor": "Coordination model and subcontractors models/BIMsight Projectdata1/GEELEN-Breedplaat V2.ifc",
					"3rd floor": "Coordination model and subcontractors models/BIMsight Projectdata1/GEELEN-Breedplaat V3.ifc",
					"roof": "Coordination model and subcontractors models/BIMsight Projectdata1/GEELEN-Dakvloer.ifc"
				},
				"JORDAHL": "Coordination model and subcontractors models/BIMsight Projectdata1/JORDAHL-Gevelderagers.ifc",
				"LINDEN": "Coordination model and subcontractors models/BIMsight Projectdata1/LINDEN - Kozijnen.ifcZIP",
				"MULTICOM": {
					"balconies": "Coordination model and subcontractors models/BIMsight Projectdata1/MULTICOM-balkons.ifc",
					"plint": "Coordination model and subcontractors models/BIMsight Projectdata1/MULTICOM-banden.ifc",
					"stairs": "Coordination model and subcontractors models/BIMsight Projectdata1/MULTICOM-trappen+bordessen.ifc"
				},
				"WAARDO": "Coordination model and subcontractors models/BIMsight Projectdata1/WAARDO-Kanaalplaatvloer.ifc",
				"WILLEMSEN": {
					"highrise": "Coordination model and subcontractors models/BIMsight Projectdata1/WILLEMSEN-Hoogbouw.ifc",
					"highrise tiles": "Coordination model and subcontractors models/BIMsight Projectdata1/WILLEMSEN-Hoogbouw dakpannen.ifc",
					"lowrise": "Coordination model and subcontractors models/BIMsight Projectdata1/WILLEMSEN-Laagbouw.ifc",
					"lowrise tiles": "Coordination model and subcontractors models/BIMsight Projectdata1/WILLEMSEN-laagbouw dakpannen.ifc"
				},
				"XELLA": {
					"1st floor": "Coordination model and subcontractors models/BIMsight Projectdata1/XELLA-Begane grond.ifc",			
					"2nd floor": "Coordination model and subcontractors models/BIMsight Projectdata1/XELLA-1e verdieping.ifc",	
					"3rd floor": "Coordination model and subcontractors models/BIMsight Projectdata1/XELLA-2e verdieping.ifc",
					"4th floor": "Coordination model and subcontractors models/BIMsight Projectdata1/XELLA-3e verdieping.ifc"
				},
				"YTONG": {
					"general": "Coordination model and subcontractors models/BIMsight Projectdata1/YTONG-Algemeen.ifc",
					"plot01": "Coordination model and subcontractors models/BIMsight Projectdata1/YTONG-Kavel 01.ifc",
					"plot02": "Coordination model and subcontractors models/BIMsight Projectdata1/YTONG-Kavel 02.ifc",
					"plot03": "Coordination model and subcontractors models/BIMsight Projectdata1/YTONG-Kavel 03.ifc",
					"plot04": "Coordination model and subcontractors models/BIMsight Projectdata1/YTONG-Kavel 04.ifc",
					"plot05": "Coordination model and subcontractors models/BIMsight Projectdata1/YTONG-Kavel 05.ifc",
					"plot06": "Coordination model and subcontractors models/BIMsight Projectdata1/YTONG-Kavel 06.ifc",
					"plot07": "Coordination model and subcontractors models/BIMsight Projectdata1/YTONG-Kavel 07.ifc",
					"plot08": "Coordination model and subcontractors models/BIMsight Projectdata1/YTONG-Kavel 08.ifc",
					"plot09": "Coordination model and subcontractors models/BIMsight Projectdata1/YTONG-Kavel 09.ifc",
					"plot10": "Coordination model and subcontractors models/BIMsight Projectdata1/YTONG-Kavel 10.ifc"
				}
			}
		}
	};
	
	function createProjects(structure, list, parent, promise) {
		if (typeof structure == "object") {
			for (var key in structure) {
				if (parent == null) {
					promise.inc();
					(function(key){
						Global.bimServerApi.call("ServiceInterface", "addProject", {projectName: key, schema: "ifc2x3tc1"}, function(project){
							createProjects(structure[key], list, project, promise);
							promise.dec();
						});
					})(key);
				} else {
					promise.inc();
					(function(key){
						Global.bimServerApi.call("ServiceInterface", "addProjectAsSubProject", {parentPoid: parent.oid, projectName: key, schema: "ifc2x3tc1"}, function(project){
							createProjects(structure[key], list, project, promise);
							promise.dec();
						});
					})(key);
				}
			}
		} else {
			promise.inc();
			Global.bimServerApi.call("ServiceInterface", "getSuggestedDeserializerForExtension", {extension: "ifc", poid: parent.oid}, function(deserializer){
				list.push({project: parent, file: structure, deserializer: deserializer});
				promise.dec();
			});
		}
	}
	
	function checkin(list, index, item) {
		cd.find(".message").html("Checking in: " + item.file.substring(item.file.lastIndexOf("/") + 1)).show();
		cd.find(".progress .progress-bar").css("width", (100 * index / list.length) + "%");
		Global.bimServerApi.call("ServiceInterface", "checkinFromUrlSync", {
			poid: item.project.oid,
			comment: "Demo Checkin",
			deserializerOid: item.deserializer.oid,
			fileName: item.file.substring(item.file.lastIndexOf("/") + 1),
			url: "https://github.com/buildingSMART/Sample-Test-Files/raw/master/IFC%202x3/Schependomlaan/" + encodeURIComponent(item.file),
			merge: false
		}, function(){
			index++;
			if (index < list.length) {
				checkin(list, index, list[index]);
			} else {
				cd.find(".message").html("Done, you can close this window").show();
				$.cookie(main.user.oid + "importalert", false);
				cd.find(".progress").hide();
			}
		});
	}
	
	cd.find(".startBtn").click(function(){
		cd.find(".startBtn").hide();
		var list = [];
		cd.find(".message").html("Creating projects...").show();
		var promise = new BimServerApiPromise()
		createProjects(o.structure, list, null, promise);
		promise.done(function(){
			cd.find(".progress").show();
			var index = 0;
			var item = list[index];
			checkin(list, index, item);
		})
	});
}
</script>
